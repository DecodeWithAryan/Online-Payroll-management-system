<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Attendance â€“ Payroll System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* Page Background */
body{
  margin:0;
  font-family:Poppins,Arial;
  background:linear-gradient(135deg,#dbeafe,#eef3ff,#ffffff);
}

/* Header */
header{
  background:linear-gradient(90deg,#1e3a8a,#2563eb,#3b82f6);
  color:#fff;
  padding:18px;
  font-size:24px;
  text-align:center;
  font-weight:700;
  letter-spacing:.5px;
  box-shadow:0 6px 25px rgba(0,0,0,.2);
}

/* Main Container */
.container{
  max-width:900px;
  margin:35px auto;
  background:rgba(255,255,255,0.85);
  padding:30px;
  border-radius:18px;
  box-shadow:0 8px 40px rgba(0,0,0,0.15);
  backdrop-filter:blur(6px);
}

/* Labels */
label{
  font-size:16px;
  font-weight:600;
  margin-top:14px;
  display:block;
  color:#1e293b;
}

/* Inputs */
select,input{
  width:100%;
  padding:12px;
  font-size:15px;
  border:1px solid #d0d7e6;
  border-radius:10px;
  margin-top:6px;
  transition:.3s;
}
select:focus,input:focus{
  border-color:#2563eb;
  box-shadow:0 0 0 3px rgba(37,99,235,0.28);
  outline:none;
}

/* Button */
button{
  margin-top:20px;
  padding:14px;
  width:100%;
  background:#2563eb;
  color:white;
  border:0;
  border-radius:12px;
  font-size:17px;
  font-weight:600;
  cursor:pointer;
  transition:.3s;
  box-shadow:0 8px 25px rgba(37,99,235,.35);
}
button:hover{
  background:#1e4ed8;
  transform:translateY(-3px);
  box-shadow:0 12px 30px rgba(37,99,235,.45);
}

/* Table */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:30px;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 5px 25px rgba(0,0,0,.08);
}

th,td{
  padding:12px 10px;
  border-bottom:1px solid #e2e8f0;
  font-size:15px;
}
th{
  background:#f1f5ff;
  font-size:16px;
  font-weight:700;
  color:#1e293b;
}

/* Table Row Hover */
tbody tr:hover{
  background:#f8fbff;
}

/* STATUS BADGES */
.status-present{
  background:#bbf7d0;
  color:#166534;
  padding:6px 12px;
  border-radius:8px;
  font-weight:600;
}
.status-absent{
  background:#fecaca;
  color:#991b1b;
  padding:6px 12px;
  border-radius:8px;
  font-weight:600;
}
.status-leave{
  background:#fef9c3;
  color:#854d0e;
  padding:6px 12px;
  border-radius:8px;
  font-weight:600;
}
</style>
</head>

<body>

<header>Attendance Management</header>

<div class="container">

  <label>Employee</label>
  <select id="employeeSelect"></select>

  <label>Date</label>
  <input type="date" id="attDate">

  <label>Status</label>
  <select id="attStatus">
    <option value="">Choose</option>
    <option value="Present">Present</option>
    <option value="Absent">Absent</option>
    <option value="Leave">Leave</option>
  </select>

  <button onclick="markAttendance()">Save Attendance</button>

  <table id="attendanceTable"></table>

</div>


<script>

/* ================= LOAD EMPLOYEES ================= */
async function loadEmployees(){
  const res = await fetch("/api/employees", {
    headers:{ "Authorization":"Bearer " + localStorage.getItem("token") }
  });

  const j = await res.json();

  let options = "<option value=''>Select Employee</option>";

  (j.employees || []).forEach(emp => {
    options += `<option value="${emp.id}">${emp.name}</option>`;
  });

  employeeSelect.innerHTML = options;
}


/* ================= MARK ATTENDANCE ================= */
async function markAttendance(){
  const employee_id = employeeSelect.value;
  const date = attDate.value;
  const status = attStatus.value;

  if(!employee_id || !date || !status){
    alert("Please fill all fields");
    return;
  }

  const res = await fetch("/api/attendance", {
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + localStorage.getItem("token")
    },
    body: JSON.stringify({ employee_id, date, status })
  });

  const out = await res.json();
  alert(out.message);
  loadAttendance();
}


/* ================= LOAD ATTENDANCE TABLE ================= */
async function loadAttendance(){
  const res = await fetch("/api/attendance", {
    headers:{ "Authorization":"Bearer " + localStorage.getItem("token") }
  });

  const j = await res.json();

  let html = `
    <tr>
      <th>Name</th>
      <th>Date</th>
      <th>Status</th>
    </tr>
  `;

  (j.records || []).forEach(r => {

    let badge = r.status === "Present" ? "status-present" :
                r.status === "Absent" ? "status-absent" :
                "status-leave";

    html += `
      <tr>
        <td>${r.name}</td>
        <td>${r.date}</td>
        <td><span class="${badge}">${r.status}</span></td>
      </tr>
    `;
  });

  attendanceTable.innerHTML = html;
}


/* INITIAL LOAD */
loadEmployees();
loadAttendance();

</script>

</body>
</html>
